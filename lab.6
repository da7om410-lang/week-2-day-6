import numpy as np
import pandas as pd

# --------------------------------------------------
# 1) Load / define dataset
# --------------------------------------------------
try:
    path = "/mnt/data/day06_user_data.csv"
    df_raw = pd.read_csv(path)
except FileNotFoundError:
    raw = {
        "age": [25, "N/A", 40, 33, "?"],
        "income": [50000, 60000, None, "unknown", 80000],
        "churned": [0, 1, 0, 1, 0],
    }
    df_raw = pd.DataFrame(raw)

# --------------------------------------------------
# 2) Normalize missing tokens to NaN
# --------------------------------------------------
missing_tokens = ["N/A", "NA", "not reported", "unknown", "?"]
df = df_raw.replace(missing_tokens, np.nan)

# --------------------------------------------------
# 3) Missingness summary
# --------------------------------------------------
def missing_summary(df):
    col_missing_pct = df.isna().mean() * 100
    row_missing_pct = df.isna().mean(axis=1) * 100
    return col_missing_pct, row_missing_pct

col_miss, row_miss = missing_summary(df)

print("Missing % per column:")
print(col_miss)
print("\nMissing % per row:")
print(row_miss)

# --------------------------------------------------
# 4) Version A: drop rows with missing in key columns
# --------------------------------------------------
key_cols = ["age", "income"]
df_A = df.dropna(subset=key_cols)

# --------------------------------------------------
# 5) Version B: impute + missing indicators
# --------------------------------------------------
df_B = df.copy()

num_cols = df_B.select_dtypes(include="number").columns

# add missing indicators
for c in num_cols:
    df_B[c + "_missing"] = df_B[c].isna().astype(int)

# median imputation
for c in num_cols:
    df_B[c] = df_B[c].fillna(df_B[c].median())

# --------------------------------------------------
# 6) Compare basic metrics between A and B
# --------------------------------------------------
print("\n=== Version A (Dropped rows) ===")
print("Shape:", df_A.shape)
print(df_A.describe(numeric_only=True))

print("\n=== Version B (Imputed + indicators) ===")
print("Shape:", df_B.shape)
print(df_B.describe(numeric_only=True))
